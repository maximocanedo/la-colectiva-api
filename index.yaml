openapi: 3.1.0
info:
    title: La Colectiva
    version: 1.0.0-oas3.1
    contact:
        name: Máximo Canedo
        url: http://maximocanedo.com.ar/
        email: maximotomascanedo@gmail.com
    description: Realizar consultas y administrar horarios, y registros de La Colectiva.
servers:
  - url: https://colectiva.com.ar:5050
    description: Servidor en línea de La Colectiva.
  - url: http://localhost
    description: Servidor local para pruebas.
components:
    securitySchemes:
        bearerAuth:
            type: http
            scheme: bearer
            bearerFormat: JWT
    schemas:
        $ref: './api/schemas/schemas.yaml#/schemas'
paths:
    # Autenticación
    /auth:
        post:
            description: Iniciar sesión
            requestBody:
                description: Credenciales del usuario.
                content:
                    application/json:
                        schema:
                            $ref: "#/components/schemas/AuthReq"
            responses:
                "200":
                    description: Inicio de sesión exitoso.
                    content:
                        application/json:
                            schema:
                                type: object
                                properties:
                                    token: 
                                        schema:
                                            type: string
                "401":
                    description: Credenciales inválidas.
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/GeneralError"
                "500":
                    description: "Error interno. "
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/GeneralError"
    # Usuarios
    /users:
        post:
            description: Crear una cuenta de usuario.
            requestBody:
                description: Información de la nueva cuenta.
                content:
                    application/json:
                        schema: 
                            $ref: '#/components/schemas/UserSignUp'
            responses:
                "201":
                    description: Usuario registrado correctamente.
                "409":
                    description: El nombre de usuario y/o correo no están disponibles.
                "500":
                    description: Ocurrió un error al intentar crear el usuario.
    /users/{username}:
        get:
            description: Obtener información sobre un usuario específico.
            parameters:
                -   name: username
                    in: path
                    required: true
                    schema:
                        type: string
            responses:
                "200":
                    description: Usuario encontrado.
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/User"
                "404":
                    description: Usuario no encontrado.
                    content:
                            application/json:
                                schema:
                                    $ref: "#/components/schemas/GeneralError"
                "500":
                    description: "Error interno. "
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/GeneralError"
        head:
            description: Saber si un usuario existe.
            parameters:
                -   name: username
                    in: path
                    required: true
                    schema:
                        type: string
            responses:
                "200":
                    description: Usuario encontrado.
                "404":
                    description: Usuario no encontrado.
                "500":
                    description: "Error interno. "
        put:
            description: Editar información de un usuario específico.
            parameters:
                -   name: username
                    in: path
                    required: true
                    schema:
                        type: string
            security:
            - bearerAuth: []
            requestBody:
                description: Datos nuevos.
                content:
                    application/json:
                        schema:
                            $ref: "#/components/schemas/UserEdit"
            responses:
                "200": 
                    description: Los datos fueron actualizados correctamente.
                "400":
                    description: Se requiere al menos un campo para editar.
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/GeneralError"
                "401":
                    description: No inició sesión.
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/GeneralError"
                "403":
                    description: No dispone de los permisos suficientes para realizar esta acción.
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/GeneralError"
                "404":
                    description: Usuario no encontrado. 
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/GeneralError"
                "500":
                    description: Error al intentar editar los datos del usuario.
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/GeneralError"
        delete:
            description: Deshabilitar usuario específico.
            parameters:
                -   name: username
                    in: path
                    required: true
                    schema:
                        type: string
            security:
                - bearerAuth: []
            responses:
                "200":
                    description: Usuario dado de baja exitosamente.
                "401":
                    description: No inició sesión.
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/GeneralError"
                "403":
                    description: No dispone de los permisos suficientes para realizar esta acción.
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/GeneralError"
                "404":
                    description: Usuario no encontrado. 
                    content:
                            application/json:
                                schema:
                                    $ref: "#/components/schemas/GeneralError"
                "500":
                    description: Error al intentar deshabilitar el usuario.
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/GeneralError"
        patch:
            description: Cambiar contraseña o rol de un usuario específico.
            parameters:
                -   name: username
                    in: path
                    required: true
                    schema:
                        type: string
            security:
                - bearerAuth: []
            requestBody:
                description: Contraseña o rol que se desea cambiar al usuario.
                content:
                    application/json:
                        schema:
                            $ref: "#/components/schemas/UserUpdatePassOrRole"
            responses:
                "200":
                    description: Se cambió exitosamente el rol o la contraseña del usuario.
                "400": 
                    description: Se requiere al menos un campo para actualizar.
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/GeneralError"
                "401":
                    description: No inició sesión.
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/GeneralError"
                "403":
                    description: No dispone de los permisos suficientes para realizar esta acción.
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/GeneralError"
                "404":
                    description: Usuario no encontrado. 
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/GeneralError"
                "500":
                    description: Error al intentar cambiar la clave o el rol del usuario.
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/GeneralError"
    /users/me:
        get:
            description: Información sobre el perfil actual.
            responses:
                "200":
                    description: Usuario encontrado.
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/User"
                "401":
                    description: No inició sesión.
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/GeneralError"
                "404":
                    description: Usuario no encontrado.
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/GeneralError"
                "500":
                    description: "Error interno. "
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/GeneralError"
        put:
            description: Editar información de mi cuenta.
            security:
                - bearerAuth: []
            requestBody:
                description: Datos nuevos.
                content:
                    application/json:
                        schema:
                            $ref: "#/components/schemas/UserEdit"
            responses:
                "200": 
                    description: Los datos fueron actualizados correctamente.
                "400":
                    description: Se requiere al menos un campo para editar.
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/GeneralError"
                "401":
                    description: No inició sesión.
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/GeneralError"
                "404":
                    description: Usuario no encontrado. 
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/GeneralError"
                "500":
                    description: Error al intentar editar los datos del usuario.
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/GeneralError"
        delete:
            description: Deshabilitar mi cuenta.
            security:
                - bearerAuth: []
            responses:
                "200":
                    description: Usuario dado de baja exitosamente.
                "401":
                    description: No inició sesión.
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/GeneralError"
                "404":
                    description: Usuario no encontrado. 
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/GeneralError"
                "500":
                    description: Error al intentar deshabilitar el usuario.
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/GeneralError"
        patch:
            description: Cambiar mi contraseña.
            security:
                - bearerAuth: []
            requestBody:
                description: Contraseña que se desea cambiar.
                content:
                    application/json:
                        schema:
                            type: object
                            required:
                                - "password"
                            properties:
                                password:
                                    schema:
                                        $ref: "#/components/schemas/User_Password"
            responses:
                "200":
                    description: Se cambió exitosamente el rol o la contraseña del usuario.
                "400": 
                    description: Se requiere al menos un campo para actualizar.
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/GeneralError"
                "401":
                    description: No inició sesión.
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/GeneralError"
                "404":
                    description: Usuario no encontrado. 
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/GeneralError"
                "500":
                    description: Error al intentar cambiar la clave o el rol del usuario.
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/GeneralError"
    /users/me/mail:
        post:
            description: Pedir un código de verificación para validar correo electrónico.
            security: 
                - bearerAuth: []
            requestBody:
                description: Nuevo correo electrónico.
                content:
                    application/json:
                        schema:
                            type: object
                            properties:
                                mail:
                                    schema:
                                        $ref: "#/components/schemas/User_Email"
            responses:
                "200":
                    description: Correo electrónico enviado.
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/MailVerificationResponse"
                "401":
                    description: No inició sesión.
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/GeneralError"
                "500":
                    description: Error interno.
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/GeneralError"
    /users/{username}/recover:
        post:
            parameters:
                -   name: username
                    in: path
                    required: true
                    schema:
                        type: string
            description: Enviar un código de recuperación al correo electrónico para cambiar la contraseña.
            responses:
                "200":
                    description: Código enviado exitosamente.
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/MailVerificationResponse"
                "404":
                    description: Usuario no encontrado.
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/MailVerificationResponse"
                "500":
                    description: Error interno.
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/MailVerificationResponse"
    /users/validate/{validationId}:
        post:
            parameters:
                -   name: validationId
                    in: path
                    required: true
                    schema:
                        $ref: "#/components/schemas/OID"
            description: Validar código recibido por correo.
            requestBody:
                description: Código enviado por correo, y, si se está intentando recuperar la cuenta, también la nueva contraseña.
                content:
                    application/json:
                        schema:
                            code:
                                schema:
                                    type: integer
                            password:
                                schema:
                                    $ref: "#/components/schemas/User_Password"
            responses:
                "204":
                    description: Código válido. Cuenta verificada. 
                "400":
                    description: Falta un campo requerido.
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/GeneralError"
                "401":
                    description: El código no es el enviado por correo.
                "404":
                    description: El registro de validación no existe.
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/GeneralError"
                "500":
                    description: Error interno.
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/GeneralError"










